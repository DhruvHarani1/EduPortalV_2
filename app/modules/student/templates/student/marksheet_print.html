<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marksheet - {{ student.enrollment_number }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media print {
            @page { size: A4; margin: 0; }
            body { 
                print-color-adjust: exact; 
                -webkit-print-color-adjust: exact; 
                margin: 0;
            }
            .no-print { display: none; }
        }
        .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 8rem;
            opacity: 0.03;
            font-weight: bold;
            color: #000;
            pointer-events: none;
            z-index: 0;
            white-space: nowrap;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <!-- Print Controls -->
    <div class="no-print fixed top-6 right-6 z-50 flex gap-4">
        <button onclick="window.print()" class="bg-indigo-600 text-white px-6 py-2 rounded-lg shadow hover:bg-indigo-700 font-medium transition">
            Print / Save as PDF
        </button>
        <button onclick="window.close()" class="bg-gray-600 text-white px-6 py-2 rounded-lg shadow hover:bg-gray-700 font-medium transition">
            Close Window
        </button>
    </div>

    <!-- Marksheet Container -->
    <div class="max-w-[210mm] mx-auto bg-white shadow-2xl my-10 min-h-[297mm] relative overflow-hidden print:shadow-none print:m-0 print:border-none print:w-full">
        
        <!-- Decorative Border -->
        <div class="absolute inset-4 border-4 border-double border-gray-800 pointer-events-none z-10"></div>
        
        <div class="absolute inset-0 watermark flex items-center justify-center">
            <h1 class="text-9xl font-black text-gray-100 rotate-[-45deg] select-none">EDU PORTAL</h1>
        </div>

        <!-- Content Padding -->
        <div class="p-12 relative z-20 h-full flex flex-col">
            
            <!-- Header -->
            <div class="text-center border-b-2 border-gray-800 pb-8 mb-8">
                <div class="flex items-center justify-center mb-4">
                    <!-- Logo Placeholder -->
                    <div class="w-20 h-20 bg-gray-900 rounded-full flex items-center justify-center text-white font-bold text-3xl">
                        EP
                    </div>
                </div>
                <h1 class="text-4xl font-serif font-bold text-gray-900 tracking-wide uppercase">Edu Portal University</h1>
                <p class="text-gray-600 mt-2 font-serif text-lg">Excellence in Education</p>
                <div class="mt-6 inline-block border bg-gray-900 text-white px-6 py-1 text-sm font-bold tracking-widest uppercase">
                    Grade Card / Marksheet
                </div>
            </div>

            <!-- Student Details -->
            <div class="grid grid-cols-2 gap-x-12 gap-y-4 mb-10 font-serif text-gray-800">
                <div class="flex">
                    <span class="font-bold w-32">Student Name:</span>
                    <span class="border-b border-gray-400 flex-1">{{ student.display_name }}</span>
                </div>
                <div class="flex">
                    <span class="font-bold w-32">Enrollment No:</span>
                    <span class="border-b border-gray-400 flex-1">{{ student.enrollment_number }}</span>
                </div>
                <div class="flex">
                    <span class="font-bold w-32">Course:</span>
                    <span class="border-b border-gray-400 flex-1">{{ student.course_name }}</span>
                </div>
                <div class="flex">
                    <span class="font-bold w-32">Semester:</span>
                    <span class="border-b border-gray-400 flex-1">{{ exam.semester }}</span>
                </div>
                <div class="flex col-span-2">
                    <span class="font-bold w-32">Examination:</span>
                    <span class="border-b border-gray-400 flex-1">{{ exam.name }} ({{ exam.academic_year }})</span>
                </div>
            </div>

            <!-- Marks Table -->
            <div class="flex-grow">
                <table class="w-full border-collapse border border-gray-900 mb-8 font-serif">
                    <thead>
                        <tr class="bg-gray-100 text-sm uppercase">
                            <th class="border border-gray-900 p-3 w-16">Code</th>
                            <th class="border border-gray-900 p-3 text-left">Subject Title</th>
                            <th class="border border-gray-900 p-3 w-20">Credits</th>
                            <th class="border border-gray-900 p-3 w-24">Max Marks</th>
                            <th class="border border-gray-900 p-3 w-24">Obtained</th>
                            <th class="border border-gray-900 p-3 w-20">Grade</th>
                            <th class="border border-gray-900 p-3 w-20">Points</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for res in results %}
                        <tr class="text-center text-gray-800">
                            <td class="border border-gray-900 p-3 text-sm">{{ res.code }}</td>
                            <td class="border border-gray-900 p-3 text-left font-semibold">{{ res.subject }}</td>
                            <td class="border border-gray-900 p-3">{{ res.credits }}</td>
                            <td class="border border-gray-900 p-3">{{ res.max_marks }}</td>
                            <td class="border border-gray-900 p-3 font-bold">{{ res.marks|round(2) }}</td>
                            <td class="border border-gray-900 p-3 font-bold">{{ res.grade }}</td>
                            <td class="border border-gray-900 p-3">{{ res.points }}</td>
                        </tr>
                        {% endfor %}
                        
                        <!-- Total Row -->
                        <tr class="bg-gray-50 font-bold border-t-2 border-gray-900">
                            <td class="border border-gray-900 p-3 text-right" colspan="2">TOTAL</td>
                            <td class="border border-gray-900 p-3"></td>
                            <td class="border border-gray-900 p-3">{{ total_max_marks }}</td>
                            <td class="border border-gray-900 p-3">{{ total_marks_obtained|round(2) }}</td>
                            <td class="border border-gray-900 p-3" colspan="2"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Footer Summary -->
            <div class="border-t-2 border-gray-800 pt-6 mt-auto">
                <div class="grid grid-cols-2 gap-8 items-end">
                    
                    <!-- Grading Key -->
                    <div class="text-xs text-gray-500">
                        <p class="mb-1 font-bold">Grading System:</p>
                        <ul class="grid grid-cols-2 gap-x-4">
                            <li>AA: 90-100 (10 Pts)</li>
                            <li>AB: 80-89 (9 Pts)</li>
                            <li>BB: 70-79 (8 Pts)</li>
                            <li>BC: 60-69 (7 Pts)</li>
                        </ul>
                    </div>

                    <!-- Final Result -->
                    <div class="text-right">
                        <div class="inline-block border-2 border-gray-900 p-4 min-w-[200px]">
                            <p class="text-xs uppercase text-gray-600 mb-1">Semester Performance Index</p>
                            <p class="text-4xl font-black text-gray-900">SPI: {{ spi }}</p>
                            <p class="text-sm font-bold text-green-700 mt-1 uppercase">Result: PASS</p>
                        </div>
                    </div>
                </div>

                <div class="flex justify-between items-end mt-12 pt-8">
                    <div class="text-center">
                        <p class="text-sm text-gray-500 mb-8">Prepared By</p>
                        <div class="w-32 h-px bg-gray-400"></div>
                    </div>
                    <div class="text-center">
                        <p class="text-sm text-gray-500 mb-8">Checked By</p>
                        <div class="w-32 h-px bg-gray-400"></div>
                    </div>
                    <div class="text-center">
                        <p class="text-sm text-gray-500 mb-2">Controller of Examinations</p>
                        <!-- Signature Placeholder -->
                        <div class="font-script text-3xl text-indigo-900 opacity-80 mb-[-10px]">Sig.</div>
                        <div class="w-48 h-px bg-gray-900"></div>
                        <p class="text-xs text-gray-400 mt-2">Date: {{ exam.end_date }}</p>
                    </div>
                </div>
                
                <p class="text-[10px] text-gray-400 text-center mt-8">
                    This is a computer generated document. Errors and Omissions Excepted. 
                    Verify authenticity at www.eduportal.com/verify
                </p>
            </div>

        </div>
    </div>

    <!-- PAGE 2: Instructions and Formulas -->
    <div class="max-w-[210mm] mx-auto bg-white shadow-2xl my-10 min-h-[297mm] relative overflow-hidden print:shadow-none print:m-0 print:border-none print:break-before-page" style="page-break-before: always;">
        
        <!-- Content Padding -->
        <div class="p-16 relative z-20 h-full flex flex-col font-serif text-gray-800">
            
            <div class="border-b-2 border-gray-800 pb-4 mb-8">
                <h2 class="text-2xl font-bold uppercase text-gray-900">Grading & Evaluation Standards</h2>
                <p class="text-gray-600 italic">Reference: University Ordinance No. 42 (Academics)</p>
            </div>

            <!-- 1. Grading System -->
            <div class="mb-10">
                <h3 class="text-lg font-bold uppercase mb-4 border-l-4 border-gray-900 pl-3">1. Grading System</h3>
                <table class="w-full border-collapse border border-gray-400 text-sm">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border border-gray-400 p-2">Grade</th>
                            <th class="border border-gray-400 p-2">Description</th>
                            <th class="border border-gray-400 p-2">Marks Range</th>
                            <th class="border border-gray-400 p-2">Grade Points</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td class="border border-gray-400 p-2 text-center font-bold">AA</td><td class="border border-gray-400 p-2">Outstanding</td><td class="border border-gray-400 p-2 text-center">90 - 100</td><td class="border border-gray-400 p-2 text-center">10</td></tr>
                        <tr><td class="border border-gray-400 p-2 text-center font-bold">AB</td><td class="border border-gray-400 p-2">Excellent</td><td class="border border-gray-400 p-2 text-center">80 - 89</td><td class="border border-gray-400 p-2 text-center">9</td></tr>
                        <tr><td class="border border-gray-400 p-2 text-center font-bold">BB</td><td class="border border-gray-400 p-2">Very Good</td><td class="border border-gray-400 p-2 text-center">70 - 79</td><td class="border border-gray-400 p-2 text-center">8</td></tr>
                        <tr><td class="border border-gray-400 p-2 text-center font-bold">BC</td><td class="border border-gray-400 p-2">Good</td><td class="border border-gray-400 p-2 text-center">60 - 69</td><td class="border border-gray-400 p-2 text-center">7</td></tr>
                        <tr><td class="border border-gray-400 p-2 text-center font-bold">CC</td><td class="border border-gray-400 p-2">Above Average</td><td class="border border-gray-400 p-2 text-center">50 - 59</td><td class="border border-gray-400 p-2 text-center">6</td></tr>
                        <tr><td class="border border-gray-400 p-2 text-center font-bold">CD</td><td class="border border-gray-400 p-2">Average</td><td class="border border-gray-400 p-2 text-center">40 - 49</td><td class="border border-gray-400 p-2 text-center">5</td></tr>
                        <tr><td class="border border-gray-400 p-2 text-center font-bold text-red-600">FF</td><td class="border border-gray-400 p-2 text-red-600">Fail</td><td class="border border-gray-400 p-2 text-center text-red-600">&lt; 40</td><td class="border border-gray-400 p-2 text-center text-red-600">0</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 2. Calculation Formulas -->
            <div class="mb-10">
                <h3 class="text-lg font-bold uppercase mb-4 border-l-4 border-gray-900 pl-3">2. Performance Indices Calculation</h3>
                
                <div class="bg-gray-50 p-6 border border-gray-200 mb-6">
                    <h4 class="font-bold mb-2">Semester Performance Index (SPI)</h4>
                    <p class="mb-2 text-sm text-gray-600">The SPI is the weighted average of the grade points obtained in all courses registered by the student during the semester.</p>
                    <div class="font-mono text-center bg-white border border-gray-300 p-4 rounded text-sm">
                        SPI = Σ (Ci × Gi) / Σ Ci
                    </div>
                    <ul class="list-disc list-inside text-xs mt-3 text-gray-500">
                        <li><strong>Ci</strong>: Credits assigned to the i-th course.</li>
                        <li><strong>Gi</strong>: Grade point earned in the i-th course.</li>
                    </ul>
                </div>

                <div class="bg-gray-50 p-6 border border-gray-200">
                    <h4 class="font-bold mb-2">Cumulative Grade Point Average (CGPA)</h4>
                    <p class="mb-2 text-sm text-gray-600">The CGPA is the weighted average of the grade points obtained in all courses registered by the student since the beginning of the program.</p>
                    <div class="font-mono text-center bg-white border border-gray-300 p-4 rounded text-sm">
                        CGPA = Σ (Cj × Gj) / Σ Cj
                    </div>
                    <ul class="list-disc list-inside text-xs mt-3 text-gray-500">
                        <li><strong>Cj</strong>: Credits of the j-th course up to the current semester.</li>
                        <li><strong>Gj</strong>: Grade point of the j-th course.</li>
                    </ul>
                </div>
            </div>

            <!-- 3. Passing Criteria -->
            <div class="mb-10">
                <h3 class="text-lg font-bold uppercase mb-4 border-l-4 border-gray-900 pl-3">3. Passing Criteria</h3>
                <ul class="list-disc list-inside space-y-2 text-sm">
                    <li>A student must obtain a minimum grade of <strong>CD</strong> (5.0 Grade Points) in each course to pass.</li>
                    <li>Students failing in a theory course must re-appear for the End Semester Examination.</li>
                    <li>A minimum attendance of 75% is mandatory to appear for the final examination.</li>
                </ul>
            </div>
            
            <!-- Footer -->
            <div class="mt-auto pt-8 border-t border-gray-400 text-center text-xs text-gray-500">
                <p>Edu Portal University • Academic Section</p>
                <p>Contact: academic@eduportal.com | +91 123 456 7890</p>
            </div>

        </div>
    </div>

</body>
</html>
