{% extends "base_admin.html" %}

{% block title %}Faculty Intelligence{% endblock %}

{% block admin_content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 md:px-8 py-6 space-y-8">
    
    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
        <div>
            <h1 class="text-3xl font-extrabold text-gray-900 tracking-tight">Faculty Performance Architect</h1>
            <p class="text-sm text-gray-500 mt-1">Analyzing Teaching Styles, Class Equity, and Delivery Impact.</p>
        </div>
        <a href="{{ url_for('admin.reports.dashboard') }}" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200">
            <svg class="-ml-1 mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
            </svg>
            Back to Deck
        </a>
    </div>

    <!-- Explainer Key -->
    <div class="bg-gray-50 rounded-xl p-4 border border-gray-200 text-xs text-gray-500 flex flex-wrap gap-4 justify-center">
        <span><strong class="text-emerald-700">Master Teacher:</strong> High Scores + High Equity (Ideal).</span>
        <span><strong class="text-indigo-700">Elite Coach:</strong> High Scores but Low Equity (Favors top students).</span>
        <span><strong class="text-blue-700">Empathetic Guide:</strong> High Equity but Average Scores.</span>
        <span><strong class="text-red-700">Strict Evaluator:</strong> Low Scores + Low Equity (Risk).</span>
    </div>

    <!-- Faculty Cards Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="facultyGrid">
        <!-- JS Populated -->
    </div>

    <!-- AI Insight Bar -->
    <div class="bg-gray-900 rounded-2xl shadow-xl p-6 text-white flex flex-col md:flex-row items-center gap-6 border-l-4 border-indigo-500 mt-8">
        <div class="flex-1">
             <h4 class="text-xs font-bold text-indigo-400 uppercase tracking-widest mb-1">AI Archetype Analysis</h4>
             <p class="text-lg font-medium leading-relaxed" id="aiSummary">Analyzing Teaching Patterns...</p>
             <p class="text-xs text-gray-400 mt-2 font-mono" id="aiTip">...</p>
        </div>
        <div class="px-4 py-2 bg-indigo-600 rounded-lg text-sm font-bold shadow-lg ring-1 ring-white/10" id="aiStatus">
            Status: Calibration
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
function getBadgeColor(color) {
    if (color === 'emerald') return 'bg-emerald-100 text-emerald-800 border-emerald-200';
    if (color === 'indigo') return 'bg-indigo-100 text-indigo-800 border-indigo-200';
    if (color === 'blue') return 'bg-blue-100 text-blue-800 border-blue-200';
    return 'bg-red-100 text-red-800 border-red-200';
}

document.addEventListener('DOMContentLoaded', function() {
    fetch("{{ url_for('admin.reports.faculty_data') }}")
        .then(r => r.json())
        .then(data => {
            
            const grid = document.getElementById('facultyGrid');
            grid.innerHTML = '';
            
            data.metrics.forEach(f => {
                const badgeClass = getBadgeColor(f.color);
                
                const card = document.createElement('div');
                card.className = "bg-white rounded-xl shadow-sm border border-gray-200 hover:shadow-md transition-shadow overflow-hidden group";
                card.innerHTML = `
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="h-10 w-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 font-bold border border-gray-200">
                                    ${f.name.charAt(0)}
                                </div>
                                <div>
                                    <h3 class="text-sm font-bold text-gray-900 group-hover:text-indigo-600 transition-colors">${f.name}</h3>
                                    <p class="text-xs text-gray-500">${f.subject}</p>
                                </div>
                            </div>
                            <span class="px-2 py-1 text-xs font-bold rounded-lg border ${badgeClass}">${f.archetype}</span>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="bg-gray-50 p-3 rounded-lg text-center">
                                <div class="text-xs text-gray-400 uppercase font-semibold">Class Avg</div>
                                <div class="text-xl font-bold text-gray-800">${f.avg}%</div>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-lg text-center">
                                <div class="text-xs text-gray-400 uppercase font-semibold">Equity Score</div>
                                <div class="text-xl font-bold text-gray-800">${f.equity}</div>
                            </div>
                        </div>
                        
                        <div class="w-full bg-gray-100 rounded-full h-1.5 mt-2">
                            <div class="bg-indigo-600 h-1.5 rounded-full" style="width: ${f.pass_rate}%"></div>
                        </div>
                        <div class="flex justify-between mt-1">
                            <span class="text-[10px] text-gray-400">Pass Rate</span>
                            <span class="text-[10px] text-gray-600 font-bold">${f.pass_rate}%</span>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });

            // AI Text
            if (data.insights) {
                document.getElementById('aiSummary').innerText = data.insights.summary;
                document.getElementById('aiTip').innerText = `> RECOMMENDATION: ${data.insights.tip}`;
                document.getElementById('aiStatus').innerText = data.insights.status;
            }
        });
});
</script>
{% endblock %}
