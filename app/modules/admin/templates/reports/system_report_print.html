<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EduPortal System Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media print {
            .no-print { display: none !important; }
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            @page { margin: 1cm; size: A4; }
        }
        body { background: #f3f4f6; font-family: 'Inter', sans-serif; }
        .a4-page {
            max-width: 210mm;
            margin: 20px auto;
            background: white;
            padding: 15mm;
            min-height: 297mm;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>

    <!-- Print Control Bar -->
    <div class="no-print fixed top-0 left-0 w-full bg-gray-900 text-white p-4 flex justify-between items-center z-50 shadow-lg">
        <div class="text-sm font-medium">Previewing Report</div>
        <div class="flex space-x-4">
            <button onclick="window.print()" class="bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded-md font-bold text-sm">
                Save as PDF
            </button>
            <button onclick="window.close()" class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-md font-bold text-sm">
                Close
            </button>
        </div>
    </div>

    <!-- Padding for fixed header -->
    <div class="h-16 no-print"></div>

    <!-- A4 Container -->
    <div class="a4-page relative">
        
        <!-- Header -->
        <div class="border-b-2 border-indigo-600 pb-6 mb-8 flex justify-between items-start">
            <div>
                <h1 class="text-3xl font-extrabold text-gray-900 tracking-tight">System Status Report</h1>
                <p class="text-gray-500 mt-1 text-sm">Official Internal Document</p>
            </div>
            <div class="text-right">
                <div class="text-xs text-gray-400 uppercase tracking-widest font-bold">Generated On</div>
                <div class="text-lg font-mono font-bold text-indigo-700">{{ generated_at.strftime('%Y-%m-%d %H:%M') }}</div>
            </div>
        </div>

        <!-- Executive Summary -->
        <h2 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-4 border-b border-gray-100 pb-2">01. Executive Summary</h2>
        <div class="grid grid-cols-3 gap-6 mb-10">
            <div class="bg-gray-50 border border-gray-100 p-4 rounded-lg">
                <div class="text-3xl font-bold text-gray-900">{{ total_students }}</div>
                <div class="text-xs font-bold text-gray-500 uppercase mt-1">Total Enrollment</div>
            </div>
            <div class="bg-gray-50 border border-gray-100 p-4 rounded-lg">
                <div class="text-3xl font-bold text-gray-900">{{ total_faculty }}</div>
                <div class="text-xs font-bold text-gray-500 uppercase mt-1">Active Faculty</div>
            </div>
            <div class="bg-gray-50 border border-gray-100 p-4 rounded-lg">
                <div class="text-3xl font-bold text-gray-900">{{ total_courses }}</div>
                <div class="text-xs font-bold text-gray-500 uppercase mt-1">Departments</div>
            </div>
        </div>

        <!-- Enrollment Data -->
        <h2 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-4 border-b border-gray-100 pb-2">02. Enrollment Distribution</h2>
        <table class="w-full text-left text-sm text-gray-600 mb-10">
            <thead class="bg-gray-100 border-b-2 border-gray-200">
                <tr>
                    <th class="py-2 px-3 font-bold text-gray-700 uppercase">Course / Department</th>
                    <th class="py-2 px-3 font-bold text-gray-700 text-right uppercase">Enrolled Students</th>
                    <th class="py-2 px-3 font-bold text-gray-700 text-right uppercase">Share</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
                {% for c in courses %}
                <tr>
                    <td class="py-2 px-3 font-medium text-gray-900">{{ c[0] }}</td>
                    <td class="py-2 px-3 text-right font-mono">{{ c[1] }}</td>
                    <td class="py-2 px-3 text-right text-gray-400">
                        {% if total_students > 0 %}
                            {{ ((c[1] / total_students) * 100) | round(1) }}%
                        {% else %}
                            0%
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Notice Log -->
        <h2 class="text-sm font-bold text-gray-400 uppercase tracking-wider mb-4 border-b border-gray-100 pb-2">03. Recent Activity Log</h2>
        <div class="text-xs text-gray-500 mb-2 italic">Showing last 10 system notices</div>
        <table class="w-full text-left text-xs text-gray-600 border border-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="py-2 px-3 border-r border-gray-200 font-bold">Date</th>
                    <th class="py-2 px-3 border-r border-gray-200 font-bold">Category</th>
                    <th class="py-2 px-3 font-bold">Title / Content Summary</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
                {% for n in notices %}
                <tr>
                    <td class="py-2 px-3 border-r border-gray-200 font-mono whitespace-nowrap">{{ n.created_at.strftime('%Y-%m-%d') }}</td>
                    <td class="py-2 px-3 border-r border-gray-200 uppercase font-bold text-xs">{{ n.category }}</td>
                    <td class="py-2 px-3">
                        <div class="font-bold text-gray-900">{{ n.title }}</div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Footer -->
        <div class="absolute bottom-10 left-0 w-full px-15mm text-center">
            <div class="border-t border-gray-200 pt-4 text-xs text-gray-400">
                Generated by EduPortal Admin System | Confidential
            </div>
        </div>

    </div>

    <script>
        // Auto-print disabled per user request
        // User will click the top-bar button to print/save
    </script>
</body>
</html>
