{% extends "base_admin.html" %}

{% block title %}Admin Portal | EduPortal{% endblock %}

{% block admin_content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 md:px-8 py-8">
    
    <!-- 1. Header Section -->
    <div class="md:flex md:items-center md:justify-between mb-8">
        <div class="min-w-0 flex-1">
            <h2 class="text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight">
                Dashboard Overview
            </h2>
            <p class="mt-1 text-sm text-gray-500">Welcome back, {{ current_user.username|capitalize }}. System is running optimally.</p>
        </div>
        <div class="mt-4 flex md:ml-4 md:mt-0">
            <a href="{{ url_for('admin.system_report_print') }}" target="_blank" class="inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                <svg class="h-4 w-4 mr-2 text-red-500" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                </svg>
                Generate Report PDF
            </a>
            <a href="{{ url_for('admin.notices_list') }}" class="ml-3 inline-flex items-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                Post Notice
            </a>
        </div>
    </div>

    <!-- 2. Quick Actions Grid -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
        <a href="{{ url_for('admin.students_list') }}" class="group relative flex items-center p-4 bg-white border border-gray-200 rounded-xl shadow-sm hover:border-indigo-400 hover:shadow-md transition-all">
            <div class="flex h-10 w-10 flex-none items-center justify-center rounded-lg bg-indigo-50 group-hover:bg-indigo-600 transition-colors">
                <svg class="h-6 w-6 text-indigo-600 group-hover:text-white" fill="none" class="h-6 w-6 text-indigo-600 group-hover:text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 0110.374 21c-2.331 0-4.512-.645-6.374-1.766z" />
                </svg>
            </div>
            <div class="ml-4">
                <p class="font-semibold text-gray-900 group-hover:text-indigo-600">Register Student</p>
                <p class="text-xs text-gray-500">Add new enrollment</p>
            </div>
        </a>

        <a href="{{ url_for('admin.faculty_list') }}" class="group relative flex items-center p-4 bg-white border border-gray-200 rounded-xl shadow-sm hover:border-emerald-400 hover:shadow-md transition-all">
            <div class="flex h-10 w-10 flex-none items-center justify-center rounded-lg bg-emerald-50 group-hover:bg-emerald-600 transition-colors">
                <svg class="h-6 w-6 text-emerald-600 group-hover:text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m.94 3.198l.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0112 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 016 18.719m12 0a5.971 5.971 0 00-.941-3.197m0 0A5.995 5.995 0 0012 12.75a5.995 5.995 0 00-5.058 2.772m0 0a3 3 0 00-4.681 2.72 8.986 8.986 0 003.74.477m.94-3.197a5.971 5.971 0 00-.94 3.197M15 6.75a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
            </div>
            <div class="ml-4">
                <p class="font-semibold text-gray-900 group-hover:text-emerald-600">Add Faculty</p>
                <p class="text-xs text-gray-500">Manage staff</p>
            </div>
        </a>

        <a href="{{ url_for('admin.exams.exams_dashboard') }}" class="group relative flex items-center p-4 bg-white border border-gray-200 rounded-xl shadow-sm hover:border-amber-400 hover:shadow-md transition-all">
            <div class="flex h-10 w-10 flex-none items-center justify-center rounded-lg bg-amber-50 group-hover:bg-amber-600 transition-colors">
                <svg class="h-6 w-6 text-amber-600 group-hover:text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
                </svg>
            </div>
            <div class="ml-4">
                <p class="font-semibold text-gray-900 group-hover:text-amber-600">Schedule Exam</p>
                <p class="text-xs text-gray-500">Set dates & papers</p>
            </div>
        </a>

        <a href="{{ url_for('admin.reports.dashboard') }}" class="group relative flex items-center p-4 bg-gray-900 border border-gray-800 rounded-xl shadow-sm hover:shadow-lg transition-all">
            <div class="flex h-10 w-10 flex-none items-center justify-center rounded-lg bg-gray-800 group-hover:bg-gray-700 transition-colors">
                <svg class="h-6 w-6 text-purple-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z" />
                </svg>
            </div>
            <div class="ml-4">
                <p class="font-semibold text-white">Full Intelligence</p>
                <p class="text-xs text-gray-400">View AI Insights</p>
            </div>
        </a>
    </div>

    <!-- 3. Key Metrics Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-sm font-medium text-gray-500 uppercase tracking-wider">Total Enrollment</p>
                    <h3 class="text-3xl font-bold text-gray-900 mt-2">{{ total_students }}</h3>
                </div>
                <span class="inline-flex items-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/20">Active</span>
            </div>
        </div>

        <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
             <div class="flex justify-between items-start">
                <div>
                    <p class="text-sm font-medium text-gray-500 uppercase tracking-wider">Active Faculty</p>
                    <h3 class="text-3xl font-bold text-gray-900 mt-2">{{ total_faculty }}</h3>
                </div>
                 <span class="inline-flex items-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/20">On Duty</span>
            </div>
        </div>

        <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200">
             <div class="flex justify-between items-start">
                <div>
                    <p class="text-sm font-medium text-gray-500 uppercase tracking-wider">Programs Offered</p>
                    <h3 class="text-3xl font-bold text-gray-900 mt-2">{{ total_courses }}</h3>
                </div>
                 <span class="inline-flex items-center rounded-md bg-blue-50 px-2 py-1 text-xs font-medium text-blue-700 ring-1 ring-inset ring-blue-600/20">Verified</span>
            </div>
        </div>
    </div>

    <!-- 4. Main Split: Analytics + Notices -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- Left Column: Enrollment Chart (Spatial) -->
        <div class="lg:col-span-2 bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-bold text-gray-900">Enrollment Distribution</h3>
            </div>
            <div class="relative h-80">
                <canvas id="courseChart"></canvas>
            </div>
        </div>

        <!-- Right Column: Notice Board Timeline -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6 flex flex-col h-full">
            <h3 class="text-lg font-bold text-gray-900 mb-6 flex items-center">
                <svg class="w-5 h-5 mr-2 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.34 15.84c-.688-.06-1.386-.09-2.09-.09H7.5a4.5 4.5 0 110-9h.75c.704 0 1.402-.03 2.09-.09m0 9.18c.253.962.584 1.892.985 2.783.247.55.06 1.21-.463 1.511l-.657.38c-.551.318-1.26.117-1.527-.461a20.845 20.845 0 01-1.44-4.282m3.102.069a18.03 18.03 0 01-.59-4.59c0-1.586.205-3.124.59-4.59m0 9.18a23.848 23.848 0 018.835 2.535M10.34 6.66a23.847 23.847 0 018.835-2.535m0 0A23.74 23.74 0 0018.795 3m.38 1.125a23.91 23.91 0 011.014 5.795 23.944 23.944 0 00-4.66 2.09m0 0a23.84 23.84 0 01-4.66-2.09" />
                </svg>
                Digital Notice Board
            </h3>
            
            <div class="flex-1 overflow-y-auto space-y-6 pr-2">
                {% for notice in recent_notices %}
                <div class="relative pl-6 border-l-2 border-gray-100 hover:border-indigo-300 transition-colors">
                    <div class="absolute -left-[5px] top-1 h-2.5 w-2.5 rounded-full bg-indigo-500 ring-4 ring-white"></div>
                    <p class="text-xs text-gra-400 mb-1 font-mono">{{ notice.created_at.strftime('%b %d') }}</p>
                    <h4 class="text-sm font-semibold text-gray-900 group-hover:text-indigo-600">{{ notice.title }}</h4>
                    <p class="text-xs text-gray-500 mt-1 line-clamp-2">{{ notice.content or 'No preview content available.' }}</p>
                    <span class="mt-2 inline-flex items-center rounded-full bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10">
                        {{ notice.category|capitalize }}
                    </span>
                </div>
                {% else %}
                <div class="text-center py-10">
                    <p class="text-sm text-gray-500">No active notices.</p>
                </div>
                {% endfor %}
            </div>

            <a href="{{ url_for('admin.notices_list') }}" class="mt-6 block w-full rounded-lg bg-gray-50 px-3 py-2 text-center text-sm font-semibold text-gray-900 hover:bg-gray-100">View Archive</a>
        </div>

    </div>
</div>

    <!-- Hidden Data Container for Charts (Linter Safe) -->
    <div id="chartData" 
         data-labels='{{ course_labels|tojson|safe }}' 
         data-counts='{{ course_counts|tojson|safe }}'>
    </div>

    <!-- Chart Config -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Read data safely from DOM
            const dataContainer = document.getElementById('chartData');
            const labels = JSON.parse(dataContainer.dataset.labels);
            const activeData = JSON.parse(dataContainer.dataset.counts);
            
            var ctx = document.getElementById('courseChart').getContext('2d');

        // Modern Chart Config
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    data: activeData,
                    backgroundColor: [
                        '#6366f1', '#10b981', '#f59e0b', '#ec4899', '#8b5cf6', '#3b82f6'
                    ],
                    borderWidth: 0,
                    hoverOffset: 10
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '75%',
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { padding: 20, usePointStyle: true }
                    }
                }
            }
        });
    });
</script>
{% endblock %}
